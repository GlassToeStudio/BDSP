<Window xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:vm="clr-namespace:BDSP.UI.ViewModels"
	xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Avalonia;assembly=LiveChartsCore.SkiaSharpView.Avalonia"
	xmlns:poffins="clr-namespace:BDSP.Core.Poffins;assembly=BDSP.Core"
	xmlns:controls="clr-namespace:BDSP.UI.Controls"
	xmlns:commands="clr-namespace:BDSP.UI.Commands"
	x:Class="BDSP.UI.Views.MainView"
	x:DataType="vm:MainViewModel"
	mc:Ignorable="d"
	Width="1000"
	Height="700"
	Title="BDSP Poffin Optimizer">

	<Window.DataContext>
		<vm:MainViewModel />
	</Window.DataContext>

	<TabControl>

		<!-- ========================================================= -->
		<!-- ====================== BERRIES TAB ===================== -->
		<!-- ========================================================= -->
		<TabItem Header="Berries">

			<Grid Margin="12"
				ColumnDefinitions="3*,2*"
				RowDefinitions="Auto,*">

				<!-- ================= SEARCH ================= -->
				<StackPanel 
					Orientation="Horizontal"
					Spacing="10">

					<TextBox Width="220"
						Watermark="Search berriesâ€¦"
						Text="{Binding BerrySearchText}" />
				</StackPanel>


				<Grid Grid.Row="1"
					  Grid.Column="0"
					  RowDefinitions="*,Auto"
					  Margin="0,6,0,0">

					<!-- BERRY GRID -->
					<ScrollViewer Grid.Row="0">
						<ItemsControl ItemsSource="{Binding FilteredBerries}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<UniformGrid Columns="3"/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>

							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="vm:BerryViewModel">
									<Border Margin="6"
											Padding="6"
											Background="#01FFFFFF"
											PointerPressed="BerryPointerPressed"
											PointerMoved="BerryPointerMoved"
											PointerReleased="BerryPointerReleased">

										<StackPanel IsHitTestVisible="False">
											<Image Source="{Binding Image}"
												   Width="96"
												   Height="96"/>
											<TextBlock Text="{Binding Name}"
													   HorizontalAlignment="Center"/>
										</StackPanel>

									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>

					<!-- BERRY INFO PANEL (BELOW GRID) -->
					<Border Grid.Row="1"
							Margin="6"
							Padding="10"
							Background="#202020"
							CornerRadius="8"
							IsVisible="{Binding HasSelectedBerry}">

						<StackPanel Spacing="6">

							<TextBlock Text="{Binding SelectedBerryInfo.Name}"
									   FontWeight="Bold"
									   FontSize="16"/>

							<Grid ColumnDefinitions="Auto,*"
								  RowDefinitions="Auto,Auto,Auto"
								  Margin="0,6,0,0">

								<TextBlock Text="Primary Flavor:" Grid.Row="0"/>
								<TextBlock Text="{Binding SelectedBerryInfo.PrimaryFlavor}"
										   Foreground="{Binding SelectedBerryInfo.PrimaryFlavorBrush}"
										   FontWeight="Bold"

											Grid.Row="0" Grid.Column="1"/>

								<TextBlock Text="Smoothness:" Grid.Row="1"/>
								<TextBlock Text="{Binding SelectedBerryInfo.Smoothness}"
										   Grid.Row="1" Grid.Column="1"/>

								<TextBlock Text="Rarity:" Grid.Row="2"/>
								<TextBlock Text="{Binding SelectedBerryInfo.Rarity}"
           Foreground="{Binding SelectedBerryInfo.RarityBrush}"
           FontWeight="SemiBold"

								Grid.Row="2" Grid.Column="1"/>

							</Grid>

							<Separator/>

							<TextBlock Text="Flavors" FontWeight="Bold"/>

							<UniformGrid Columns="5">
								<StackPanel>
									<TextBlock Text="Spicy"/>
									<TextBlock Text="{Binding SelectedBerryInfo.Spicy}"
											   HorizontalAlignment="Center"/>
								</StackPanel>
								<StackPanel>
									<TextBlock Text="Dry"/>
									<TextBlock Text="{Binding SelectedBerryInfo.Dry}"
											   HorizontalAlignment="Center"/>
								</StackPanel>
								<StackPanel>
									<TextBlock Text="Sweet"/>
									<TextBlock Text="{Binding SelectedBerryInfo.Sweet}"
											   HorizontalAlignment="Center"/>
								</StackPanel>
								<StackPanel>
									<TextBlock Text="Bitter"/>
									<TextBlock Text="{Binding SelectedBerryInfo.Bitter}"
											   HorizontalAlignment="Center"/>
								</StackPanel>
								<StackPanel>
									<TextBlock Text="Sour"/>
									<TextBlock Text="{Binding SelectedBerryInfo.Sour}"
											   HorizontalAlignment="Center"/>
								</StackPanel>
							</UniformGrid>

						</StackPanel>
					</Border>

				</Grid>

				<!-- ================= RIGHT PANEL ================= -->
				<StackPanel Grid.Row="1"
					Grid.Column="1"
					Spacing="12">

					<!-- ===== INGREDIENT SLOTS ===== -->
					<ItemsControl ItemsSource="{Binding Ingredients}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<UniformGrid Columns="4" Rows="1" />
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>

						<ItemsControl.ItemTemplate>
							<DataTemplate x:DataType="vm:IngredientSlotViewModel">
								<Border Width="64"
									Height="64"
									Margin="6"
									Background="#303030"
									CornerRadius="8"
									DragDrop.AllowDrop="True"
									DragDrop.DragOver="IngredientDragOver"
									DragDrop.Drop="IngredientDrop">

									<ContentControl Content="{Binding Berry}"
										HorizontalAlignment="Center"
										VerticalAlignment="Center"
										IsHitTestVisible="False">
										<ContentControl.ContentTemplate>
											<DataTemplate x:DataType="vm:BerryViewModel">
												<Image Source="{Binding Image}"
													Width="48"
													Height="48" />
											</DataTemplate>
										</ContentControl.ContentTemplate>
									</ContentControl>

								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>

					<!-- ===== COOK BUTTON ===== -->
					<Button Content="Cook Poffin"
						Command="{Binding CookPoffinCommand}"
						HorizontalAlignment="Center"
						Margin="0,6" />

					<!-- ===== POFFIN RESULT RADAR ===== -->
					<Border Width="300"
						Height="300"
						Padding="10"
						Background="#202020"
						CornerRadius="12">

						<controls:RadarChart
							Values="{Binding ResultPoffinRadar.Values}"
							Labels="{Binding ResultPoffinRadar.Labels}"
							MaxValue="{Binding ResultPoffinRadar.MaxValue}" />

					</Border>

				</StackPanel>

			</Grid>

		</TabItem>

		<!-- SEARCH TAB -->
		<TabItem Header="Search">
			<TextBlock Text="Search tab (coming later)"
				Margin="20" />
		</TabItem>

		<!-- PRESETS TAB -->
		<TabItem Header="Presets">
			<TextBlock Text="Presets tab (coming later)"
				Margin="20" />
		</TabItem>

	</TabControl>

</Window>